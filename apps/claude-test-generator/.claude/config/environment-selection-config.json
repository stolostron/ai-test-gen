{
  "smart_environment_selection": {
    "service_name": "tg_smart_environment_selection_service",
    "version": "1.0.0",
    "enabled": true,
    "execution_priority": "before_agent_d",
    
    "selection_logic": {
      "priority_1_user_provided": {
        "source": "User explicit environment specification in request",
        "extraction_patterns": [
          "using\\s+(\\S+)\\s+environment",
          "in\\s+(\\S+)\\s+cluster",
          "with\\s+(\\S+\\.\\w+)",
          "environment:\\s*(\\S+)",
          "cluster:\\s*(\\S+)"
        ],
        "validation_required": true,
        "health_threshold": 7.0,
        "fallback_on_unhealthy": true
      },
      
      "priority_2_config_environment": {
        "source": "console-url-config.json current_test_environment",
        "config_path": ".claude/config/console-url-config.json",
        "config_key": "console_url_configuration.environment_compatibility.current_test_environment",
        "validation_required": true,
        "health_threshold": 7.0,
        "fallback_on_unhealthy": true
      },
      
      "priority_3_qe6_fallback": {
        "source": "Default qe6 environment (framework standard)",
        "cluster_name": "qe6-vmware-ibm",
        "api_url": "https://api.qe6-vmware-ibm.cluster.url:6443",
        "console_url": "https://console-openshift-console.apps.qe6-vmware-ibm.cluster.url",
        "health_threshold": 6.0,
        "reliability": "high",
        "guaranteed_fallback": true
      }
    },
    
    "health_validation": {
      "enabled": true,
      "timeout_seconds": 15,
      "checks": {
        "connectivity": {
          "weight": 0.3,
          "endpoint": "/healthz",
          "timeout": 10
        },
        "api_responsiveness": {
          "weight": 0.2,
          "command": ["oc", "cluster-info"],
          "timeout": 15
        },
        "authentication": {
          "weight": 0.2,
          "command": ["oc", "whoami"],
          "timeout": 10
        },
        "acm_availability": {
          "weight": 0.2,
          "command": ["oc", "get", "multiclusterhub"],
          "timeout": 10,
          "optional": true
        },
        "cluster_stability": {
          "weight": 0.1,
          "command": ["oc", "get", "nodes"],
          "timeout": 10
        }
      },
      "scoring": {
        "healthy_threshold": 7.0,
        "fallback_threshold": 6.0,
        "scale": 10.0
      }
    },
    
    "fallback_behavior": {
      "automatic_qe6": true,
      "log_fallback_reasons": true,
      "transparent_communication": true,
      "fallback_history_tracking": true
    },
    
    "framework_integration": {
      "agent_d_integration": "automatic",
      "metadata_inclusion": true,
      "selection_logging": "comprehensive",
      "user_notification": "transparent"
    }
  },
  
  "environment_construction": {
    "domain_patterns": {
      "full_domain": "Direct usage when dots present",
      "short_name": "Construct as {name}.cluster.local",
      "dev_environment": "Detect dev domains and preserve structure"
    },
    
    "url_construction": {
      "api_url_template": "https://api.{domain}:6443",
      "console_url_template": "https://console-openshift-console.apps.{domain}",
      "placeholder_support": true
    }
  },
  
  "logging_and_transparency": {
    "selection_decisions": {
      "log_level": "INFO",
      "include_health_scores": true,
      "include_fallback_reasons": true,
      "user_notification_format": "console_output"
    },
    
    "health_check_results": {
      "log_level": "DEBUG",
      "include_individual_checks": true,
      "include_timing": true
    },
    
    "fallback_events": {
      "log_level": "WARN",
      "include_original_environment": true,
      "include_failure_reasons": true,
      "user_notification": "always"
    }
  },
  
  "integration_points": {
    "agent_d_enhancement": {
      "service_call": "execute_with_smart_environment_selection",
      "metadata_injection": "environment_selection_metadata",
      "health_score_inclusion": true
    },
    
    "framework_workflow": {
      "execution_phase": "before_phase_1",
      "blocking_behavior": "non_blocking",
      "fallback_guarantee": "always_provide_environment"
    },
    
    "configuration_sources": {
      "console_url_config": ".claude/config/console-url-config.json",
      "environment_selection_config": ".claude/config/environment-selection-config.json",
      "user_input_parsing": "real_time"
    }
  }
}