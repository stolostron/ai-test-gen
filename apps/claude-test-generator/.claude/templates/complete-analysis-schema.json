{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Complete Analysis Document Schema",
  "description": "JSON schema for validating complete analysis structure based on ACM-20640 session analysis",
  "type": "object",
  "properties": {
    "summary": {
      "type": "object",
      "properties": {
        "jira_ticket": {
          "type": "string",
          "pattern": "^ACM-\\d+",
          "description": "Must include JIRA ticket reference"
        },
        "priority_status": {
          "type": "string",
          "pattern": "^(Blocker|Critical|High|Medium|Low).*\\d+.*%",
          "description": "Must include priority and completion percentage"
        },
        "component": {
          "type": "string",
          "minLength": 5,
          "description": "Primary component being analyzed"
        },
        "target_release": {
          "type": "string",
          "pattern": "ACM \\d+\\.\\d+",
          "description": "Must specify ACM release version"
        },
        "test_environment_status": {
          "type": "string",
          "pattern": "(deployed|not deployed|partially deployed)",
          "description": "Feature deployment status in test environment"
        },
        "feature_validation": {
          "type": "string",
          "pattern": "(working|not working|partially working)",
          "description": "Agent validation results for feature functionality"
        },
        "console_url": {
          "type": "string",
          "pattern": "^https://console[a-z0-9\\-\\.]+",
          "not": {
            "pattern": "<.*>"
          },
          "description": "Must be actual console URL, no placeholders"
        },
        "acm_version": {
          "type": "string", 
          "pattern": "\\d+\\.\\d+\\.\\d+",
          "description": "Must be actual ACM version in test environment"
        },
        "ocp_version": {
          "type": "string",
          "pattern": "(\\d+\\.\\d+|Not captured during environment assessment)",
          "description": "Must be actual OCP version or explicit 'Not captured'"
        },
        "business_impact": {
          "type": "string",
          "minLength": 50,
          "description": "Clear business value statement"
        }
      },
      "required": [
        "jira_ticket", "priority_status", "component", "target_release",
        "test_environment_status", "feature_validation", "console_url", 
        "acm_version", "ocp_version", "business_impact"
      ],
      "additionalProperties": false
    },
    "implementation_analysis": {
      "type": "object",
      "properties": {
        "feature_overview": {
          "type": "string",
          "minLength": 100,
          "description": "Brief conceptual explanation of the feature - what it does, how it works, and its purpose"
        },
        "code_changes_implementation": {
          "type": "string",
          "minLength": 200,
          "description": "Detailed explanation of code changes with actual code snippets fetched from git"
        },
        "key_files_modified": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "pattern": ".+\\.(ts|js|go|py|yaml|json)",
            "description": "Files that were modified or added"
          }
        },
        "integration_points": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 10
          },
          "description": "Integration points and architectural decisions"
        }
      },
      "required": ["feature_overview", "code_changes_implementation"],
      "additionalProperties": false
    },
    "test_scenarios": {
      "type": "object",
      "properties": {
        "test_case_summaries": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "properties": {
              "test_case_name": {
                "type": "string",
                "pattern": "Test Case \\d+[A-Z]?:",
                "description": "Must follow Test Case format"
              },
              "summary": {
                "type": "string",
                "minLength": 50,
                "description": "Brief description of what this test validates"
              },
              "coverage_area": {
                "type": "string",
                "minLength": 20,
                "description": "What area or functionality this test covers"
              }
            },
            "required": ["test_case_name", "summary", "coverage_area"]
          }
        },
        "testing_approach": {
          "type": "string",
          "minLength": 100,
          "description": "Overview of the testing strategy and methodology used for validation"
        }
      },
      "required": ["test_case_summaries", "testing_approach"],
      "additionalProperties": false
    },
    "business_impact_strategic_value": {
      "type": "object",
      "properties": {
        "customer_benefits": {
          "type": "string",
          "minLength": 50,
          "description": "Direct customer value proposition"
        },
        "technical_advantages": {
          "type": "string",
          "minLength": 50,
          "description": "Technical benefits and capabilities"
        },
        "competitive_positioning": {
          "type": "string",
          "minLength": 30,
          "description": "Strategic market advantages"
        }
      },
      "required": ["customer_benefits", "technical_advantages"],
      "additionalProperties": false
    }
  },
  "required": ["summary", "implementation_analysis", "test_scenarios", "business_impact_strategic_value"],
  "validation_rules": {
    "forbidden_patterns": [
      {
        "pattern": "<CLUSTER_.*>|<TEST_.*>|<.*_DOMAIN>",
        "severity": "critical",
        "message": "Complete analysis must have actual environment details, no placeholders"
      },
      {
        "pattern": "(?i)performance.*test|stress.*test|load.*test|scale.*test",
        "severity": "critical",
        "message": "No performance/stress/load/scale testing in complete analysis"
      },
      {
        "pattern": "(?i)performance.*criteria|scale.*performance",
        "severity": "high", 
        "message": "Replace performance sections with integration/quality criteria"
      },
      {
        "pattern": "(?i)concurrent.*user|response.*time.*requirement",
        "severity": "high",
        "message": "Remove performance metrics - focus on functional requirements"
      }
    ],
    "required_patterns": [
      {
        "pattern": "Console URL: https://console[a-z0-9\\-\\.]+",
        "severity": "critical",
        "message": "Must include actual console URL"
      },
      {
        "pattern": "Test Environment Status: (deployed|not deployed|partially deployed)",
        "severity": "critical",
        "message": "Must include feature deployment status in test environment"
      },
      {
        "pattern": "Feature Validation: (working|not working|partially working)",
        "severity": "critical",
        "message": "Must include agent validation results"
      },
      {
        "pattern": "ACM Version: \\d+\\.\\d+\\.\\d+",
        "severity": "high",
        "message": "Must include actual ACM version from test environment"
      },
      {
        "pattern": "Test Case \\d+[A-Z]?:",
        "severity": "high",
        "message": "Must include test case summaries with proper formatting"
      }
    ],
    "environment_specificity_requirements": {
      "test_environment": {
        "pattern": "^[a-z0-9\\-]+\\.[a-z0-9\\-\\.]+$",
        "examples": ["almng-test.dev09.red-chesterfield.com"],
        "forbidden": ["<CLUSTER_CONSOLE_URL>", "test-cluster", "example.com"]
      },
      "console_url": {
        "pattern": "^https://console-openshift-console\\.apps\\.[a-z0-9\\-\\.]+$",
        "examples": ["https://console-openshift-console.apps.almng-test.dev09.red-chesterfield.com"],
        "forbidden": ["<CLUSTER_CONSOLE_URL>", "https://example.com"]
      },
      "versions": {
        "acm_version": {
          "pattern": "^\\d+\\.\\d+\\.\\d+( \\(Target: \\d+\\.\\d+\\+ required\\))?$",
          "examples": ["2.14.0 (Target: 2.15+ required)"]
        },
        "openshift_version": {
          "pattern": "^(\\d+\\.\\d+|Not captured during environment assessment)$",
          "examples": ["4.12", "Not captured during environment assessment"]
        }
      }
    },
    "section_structure_requirements": {
      "summary": {
        "required_order": [
          "jira_ticket",
          "priority_status", 
          "component",
          "target_release",
          "test_environment_status",
          "feature_validation",
          "console_url",
          "acm_version",
          "ocp_version",
          "business_impact"
        ]
      },
      "implementation_analysis": {
        "required_flow": [
          "feature_overview_first",
          "code_changes_implementation_with_git_snippets",
          "key_files_modified_list",
          "integration_points_explanation"
        ]
      },
      "test_scenarios": {
        "required_flow": [
          "test_case_summaries_point_by_point",
          "testing_approach_methodology"
        ]
      }
    },
    "content_quality_gates": {
      "summary_completeness": {
        "test_environment_status_required": true,
        "feature_validation_required": true,
        "business_impact_min_length": 50
      },
      "implementation_analysis_depth": {
        "feature_overview_min_length": 100,
        "code_changes_min_length": 200,
        "git_code_snippets_required": true
      },
      "test_scenarios_coverage": {
        "test_case_summaries_min_count": 1,
        "testing_approach_min_length": 100
      },
      "environment_specificity": {
        "no_placeholders_allowed": true,
        "actual_urls_required": true,
        "actual_versions_required": true
      }
    }
  }
}